pragma.syntax("0.9")

def makeTestCase := <import:com.twistedmatrix.eunit.makeTestCase>
def makeBuilder := <import:com.twistedmatrix.ometa.makeBuilder>


def makeTestBuilder() {
    def self extends makeTestCase(self) {

        to test_makeGrammar() {
            def b := makeBuilder("foo")
            def wanted := e`def makeFoo(input) {
                              def foo extends makeRuntime(input, foo) {
                              }
                              return foo
                            }`
            self.assertEqual(b.makeGrammarSource([].asMap()), wanted)
        }

        to test_buildMethod() {
           def b := makeBuilder("foo")
           def wanted := e`def makeFoo(input) {
                              def foo extends makeRuntime(input, foo) {
                                  method rule_baz() {
                                      1 + 1
                                  }
                              }
                              return foo
                            }`
            self.assertEqual(b.makeGrammarSource(["baz" => e`1 + 1`]), wanted)
        }

        to test_apply() {
            def b := makeBuilder("foo")
            def wanted := e`foo._apply("baz", [one, two])`
            self.assertEqual(b.apply("baz", [e`one`, e`two`]),
                             wanted)
        }

        to test_exactly() {
            def b := makeBuilder("foo")
            def wanted := e`foo._exactly("x")`
            self.assertEqual(b.exactly("x"),
                             wanted)
        }
    }
    return self
}
